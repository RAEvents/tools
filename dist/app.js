var E="https://retroachievements.org/API",B=(e,t,a,n={})=>{let s=`${e}/${t}`.replaceAll(/([^:]\/)\/+/g,"$1"),o={z:a.username,y:a.webApiKey};for(let[r,i]of Object.entries(n))s.includes(`:${r}`)?s=s.replace(`:${r}`,String(i)):i!==void 0&&(o[r]=String(i));return`${s}?${new URLSearchParams(o).toString()}`},N=async e=>{let{url:t}=e,a=new Headers({"User-Agent":"RetroAchievements-api-js/2.1.0"}),n=await fetch(t,typeof window!==void 0?{}:{headers:a});if(!n.ok)throw new Error(`HTTP Error: Status ${n.status} ${n.statusText}`);return await n.json()};function y(){return y=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},y.apply(this,arguments)}var f=(e,t={})=>{let{shouldCastToNumbers:a,shouldMapToBooleans:n}=t,s=e;if(Array.isArray(e)){let o=[];for(let r of e)o.push(f(r,t));s=o}else if(!Array.isArray(e)&&e instanceof Object){let o={};for(let[r,i]of Object.entries(e)){let u=i;a!=null&&a.includes(r)&&(u=i===null?null:Number(i)),n!=null&&n.includes(r)&&(u=i===null?null:String(i)==="1"),o=y({},o,{[q(r)]:f(u,t)})}s=o}return s},q=e=>{if(e.toUpperCase()===e)return e.toLowerCase();let t=e.charAt(0).toLowerCase()+e.slice(1);return t=t.replaceAll("ID","Id"),t=t.replaceAll("URL","Url"),t=t.replaceAll("rA","ra"),t=t.replaceAll("visibleUserawards","visibleUserAwards"),t},R=async(e,t)=>{let{achievementId:a,offset:n,count:s}=t,o={a};n&&(o.o=n),s&&(o.c=s);let r=B(E,"/API_GetAchievementUnlocks.php",e,o),i=await N({url:r});return f(i,{shouldCastToNumbers:["ID","Points","TrueRatio","RAPoints","RASoftcorePoints"],shouldMapToBooleans:["HardcoreMode"]})};var S,k,x;(function(e){e[e.NewSet=0]="NewSet",e[e.Revision=1]="Revision"})(S||(S={})),function(e){e[e.Active=0]="Active",e[e.Complete=1]="Complete",e[e.Dropped=2]="Dropped"}(k||(k={})),function(e){e[e.Primary=0]="Primary",e[e.Collaboration=1]="Collaboration"}(x||(x={}));var G,U;(function(e){e[e.CoreAchievements=3]="CoreAchievements",e[e.UnofficialAchievements=5]="UnofficialAchievements"})(G||(G={})),function(e){e.Primary="0",e.Collaboration="1"}(U||(U={}));var A=async(e,t)=>{let{gameId:a,username:n,shouldIncludeHighestAwardMetadata:s}=t,o={g:a,u:n};s&&(o.a=1);let r=B(E,"/API_GetGameInfoAndUserProgress.php",e,o),i=await N({url:r});return f(i,{shouldCastToNumbers:["ID","NumAwarded","NumAwardedHardcore","Points","TrueRatio","DisplayOrder","NumDistinctPlayersCasual","NumDistinctPlayersHardcore"]})};var b=e=>{if(!e.username||!e.webApiKey)throw new Error(`
      buildAuthorization() requires an object containing a
      username and webApiKey. eg:

      const authorization = buildAuthorization({
        username: "myUserName",
        webApiKey: "myWebApiKey"
      })
    `);return e};async function M(e){let t=new Blob([JSON.stringify(e)]).stream().pipeThrough(new CompressionStream("gzip")),n=await(await new Response(t).blob()).arrayBuffer();return btoa(String.fromCharCode(...new Uint8Array(n)))}async function $(e){let t=new Blob([F(e)]).stream().pipeThrough(new DecompressionStream("gzip")),a=await new Response(t).blob();return JSON.parse(await a.text())}function F(e){let t=atob(e),a=t.length,n=new Uint8Array(new ArrayBuffer(a));for(let s=0;s<a;s++)n[s]=t.charCodeAt(s);return n}function O(e,t){let a=JSON.parse(localStorage.getItem("options"));a[e]=t,localStorage.setItem("options",JSON.stringify(a))}function _(e){return JSON.parse(localStorage.getItem("options"))[e]}var J=e=>new Promise(t=>setTimeout(()=>t(),e)),K=200,H=5,v=0;async function h(){await J(K*Math.pow(2,v))}function L(){v=0}function z(e){let t=e.getUTCFullYear(),a=String(e.getUTCMonth()+1).padStart(2,"0"),n=String(e.getUTCDate()).padStart(2,"0");switch(_("dateFormat")){case 0:return`${t}-${a}-${n}`;case 1:return`${a}/${n}/${t}`;case 2:return`${n}/${a}/${t}`;case 3:return`${a}-${n}-${t}`;case 4:return`${n}-${a}-${t}`}}async function w(e,t,a,n,s){let o;for(let l=0;;l++){try{o=await A(e,{username:t,gameId:a,shouldIncludeHighestAwardMetadata:!0})}catch{if(v+=1,await h(),l<H)continue}break}let r="failure";switch(o.highestAwardKind){case"mastered":r="success mastered";break;case"beaten-hardcore":r="success";break;default:break}let i=new Date(o.highestAwardDate);(i<n||i>s)&&(r="failure");let u=o.highestAwardDate?z(i):"N/A",c=document.getElementById("altUsername").value;if(t!=c&&c.length&&r=="failure"){let l=await w(e,c,a,n);if(l.status.includes("success"))return l.status+=" alt",l}return{status:r,title:o.title,icon:o.imageIcon,timestamp:u}}async function I(e,t,a,n,s){let o,r;for(let d=0;;d++){try{o=await R(e,{count:1,achievementId:a}),r=await A(e,{username:t,gameId:o.game.id,shouldIncludeHighestAwardMetadata:!1})}catch{if(v+=1,await h(),d<H)continue}break}let i=r.achievements[o.achievement.id],u=i.dateEarnedHardcore!="",c=u?new Date(i.dateEarnedHardcore):new Date(0),l={status:u&&c>=n&&c<=s?"success":"failure",timestamp:u?z(c):"N/A",title:o.achievement.title,icon:`/Badge/${i.badgeName}.png`};if(l.status=="failure"){let d=document.getElementById("altUsername").value;if(d.length&&d!=t){let m=await I(e,d,a,n,s);if(m.status=="success")return m.status+=" alt",m}}return l}function P(e,...t){let a="";for(let[n,s]of e.entries())a+=s,n in t&&(a+=t[n]);return a}function j(){let e=new Date;document.getElementById("startdate").valueAsDate=new Date(e.getUTCFullYear(),e.getUTCMonth(),1),document.getElementById("enddate").valueAsDate=e}j();var g=new URL(window.location).searchParams;if(g.has("data")){let e=null;g.has("c")&&g.get("c")=="0"?e=JSON.parse(atob(g.get("data"))):e=await $(g.get("data"));let t=document.getElementById("startdate").value,a=document.getElementById("enddate").value;document.getElementById("username").value=e.username??"",document.getElementById("altUsername").value=e.alt??"",document.getElementById("startdate").value=e.startDate??t,document.getElementById("enddate").value=e.endDate??a,document.getElementById("submission").value=e.submission??"",document.getElementById("optionCheckDate").checked=e.optionCheckDate??!0}async function Y(){if(localStorage.getItem("auth")){let e=JSON.parse(localStorage.getItem("auth"));"apikey"in e&&(e.webApiKey=e.apikey,delete e.apikey,localStorage.setItem("auth",JSON.stringify(e)));let t=b(e);return t.toString=function(){return`z=${this.username}&y=${this.webApiKey}`},t}else return await Z()}function Z(){let t=document.getElementById("authModalTemplate").content.cloneNode(!0),a=t.children[0].querySelector("button");return document.body.appendChild(t),new Promise(n=>{a.addEventListener("click",s=>{let o=document.querySelector("div.authModal"),r={username:o.querySelector("input[name='username']").value,webApiKey:o.querySelector("input[name='apikey']").value};o.querySelector("input[name='saveinfo']").checked&&localStorage.setItem("auth",JSON.stringify(r)),document.body.removeChild(o),n(b(r))})})}document.getElementById("verify").addEventListener("click",async()=>{let e=await Y(),t=document.getElementById("username"),a=document.getElementById("altUsername"),n=document.getElementById("submission"),s=document.getElementById("startdate"),o=document.getElementById("enddate");if(L(),s.value==""){s.style.backgroundColor="red",s.addEventListener("focus",()=>s.style.backgroundColor="revert",{once:!0});return}let r=Array.from(n.value.matchAll("https://(?:www.)?retroachievements.org/game/([0-9]+)")).map(([c,l])=>l),i=Array.from(n.value.matchAll("https://(?:www.)?retroachievements.org/achievement/([0-9]+)")).map(([c,l])=>l);D("output"),t.disabled=!0,a.disabled=!0,s.disabled=!0,o.disabled=!0,output.innerHTML=P`<h1>Games</h1><hr />${r.map(c=>P`<div class="game"><div class="icon"></div><a class="title" href="https://retroachievements.org/game/${c}">${c}</a><span class="timestamp"></span><div class="status">?</div></div>`).join("")}<h1>Achievements</h1><hr />${i.map(c=>P`<div class="achievement"><div class="icon"></div><a class="title" href="https://retroachievements.org/achievement/${c}">${c}</a><span class="timestamp"></span><div class="status">?</div></div>`).join("")} `;let u=async(c,l)=>{let d=c.querySelector(".title").textContent,m=o.valueAsDate;m.setDate(m.getDate()+1);let p=await l(e,t.value,d,s.valueAsDate,m),T=c.querySelector(".status");T.classList.add(...p.status.split(" ")),T.textContent=p.status.includes("success")?p.status.includes("alt")?"A":"\u2713":"X";let C=document.createElement("img");C.src=`https://media.retroachievements.org${p.icon}`,c.querySelector(".icon").appendChild(C),c.querySelector(".title").textContent=p.title,c.querySelector(".timestamp").textContent=p.timestamp};for(let c of output.querySelectorAll(".game"))await u(c,w),await h();for(let c of output.querySelectorAll(".achievement"))await u(c,I),await h();t.disabled=!1,a.disabled=!1,s.disabled=!1,o.disabled=!1});document.getElementById("clear").addEventListener("click",()=>{document.getElementById("username").value="",document.getElementById("submission").value="",document.getElementById("output").innerHTML="",document.getElementById("username").disabled=!1,document.getElementById("startdate").disabled=!1,D("submission")});document.getElementById("optionResetAuth").addEventListener("click",()=>{localStorage.removeItem("auth")});document.getElementById("optionExportURL").addEventListener("click",async()=>{let e=document.getElementById("username").value,t=document.getElementById("altUsername").value,a=document.getElementById("startdate").value,n=document.getElementById("enddate").value,s=document.getElementById("submission").value,o=document.getElementById("optionCheckDate").checked,r=await M({username:e,alt:t,startDate:a,endDate:n,submission:s,optionCheckDate:o}),i=new URL(window.location.href);i.searchParams.set("data",r),window.location.href=i.href});document.getElementById("optionCheckDate").addEventListener("change",e=>{let t=document.getElementById("startdate");e.target.checked?(t.disabled=!1,j()):(t.disabled=!0,t.valueAsDate=new Date(0))});document.getElementById("optionDateFormat").addEventListener("change",e=>{O("dateFormat",e.target.selectedIndex)});if(!localStorage.getItem("options"))localStorage.setItem("options",JSON.stringify({dateFormat:0}));else{let e=JSON.parse(localStorage.getItem("options"));document.getElementById("optionDateFormat").selectedIndex=e.dateFormat}for(let e of document.querySelectorAll("#tabs > div")){let t=e.dataset.target;e.addEventListener("mousedown",()=>{D(t)})}function D(e){document.getElementById(e).style.display="block";for(let t of document.querySelectorAll(`#content > :not(#${e})`))t.style.display="none";for(let t of document.querySelectorAll("#tabs > div"))t.classList.remove("selected"),t.dataset.target==e&&t.classList.add("selected")}
//# sourceMappingURL=app.js.map
