var b,w,I;(function(e){e[e.NewSet=0]="NewSet",e[e.Revision=1]="Revision"})(b||(b={})),function(e){e[e.Active=0]="Active",e[e.Complete=1]="Complete",e[e.Dropped=2]="Dropped"}(w||(w={})),function(e){e[e.Primary=0]="Primary",e[e.Collaboration=1]="Collaboration"}(I||(I={}));var P,D;(function(e){e[e.CoreAchievements=3]="CoreAchievements",e[e.UnofficialAchievements=5]="UnofficialAchievements"})(P||(P={})),function(e){e.Primary="0",e.Collaboration="1"}(D||(D={}));var g=e=>{if(!e.username||!e.webApiKey)throw new Error(`
      buildAuthorization() requires an object containing a
      username and webApiKey. eg:

      const authorization = buildAuthorization({
        username: "myUserName",
        webApiKey: "myWebApiKey"
      })
    `);return e};async function T(e){let t=new Blob([JSON.stringify(e)]).stream().pipeThrough(new CompressionStream("gzip")),n=await(await new Response(t).blob()).arrayBuffer();return btoa(String.fromCharCode(...new Uint8Array(n)))}async function C(e){let t=new Blob([B(e)]).stream().pipeThrough(new DecompressionStream("gzip")),a=await new Response(t).blob();return JSON.parse(await a.text())}function B(e){let t=atob(e),a=t.length,n=new Uint8Array(new ArrayBuffer(a));for(let s=0;s<a;s++)n[s]=t.charCodeAt(s);return n}var S=e=>new Promise(t=>setTimeout(()=>t(),e));function f(e,...t){let a="";for(let[n,s]of e.entries())a+=s,n in t&&(a+=t[n]);return a}function k(){let e=new Date;document.getElementById("startdate").valueAsDate=new Date(e.getUTCFullYear(),e.getUTCMonth(),1),document.getElementById("enddate").valueAsDate=e}k();var G=new URL(window.location).searchParams;if(G.has("data")){let e=await C(G.get("data")),t=document.getElementById("startdate").value,a=document.getElementById("enddate").value;document.getElementById("username").value=e.username??"",document.getElementById("altUsername").value=e.alt??"",document.getElementById("startdate").value=e.startDate??t,document.getElementById("enddate").value=e.endDate??a,document.getElementById("submission").value=e.submission??"",document.getElementById("optionCheckDate").checked=e.optionCheckDate??!0}async function N(){if(localStorage.getItem("auth")){let e=JSON.parse(localStorage.getItem("auth"));"apikey"in e&&(e.webApiKey=e.apikey,delete e.apikey,localStorage.setItem("auth",JSON.stringify(e)));let t=g(e);return t.toString=function(){return`z=${this.username}&y=${this.webApiKey}`},t}else return await $()}function $(){let t=document.getElementById("authModalTemplate").content.cloneNode(!0),a=t.children[0].querySelector("button");return document.body.appendChild(t),new Promise(n=>{a.addEventListener("click",s=>{let i=document.querySelector("div.authModal"),l={username:i.querySelector("input[name='username']").value,webApiKey:i.querySelector("input[name='apikey']").value};i.querySelector("input[name='saveinfo']").checked&&localStorage.setItem("auth",JSON.stringify(l)),document.body.removeChild(i),n(g(l))})})}document.getElementById("verify").addEventListener("click",async()=>{let e=await N(),t=document.getElementById("username"),a=document.getElementById("altUsername"),n=document.getElementById("submission"),s=document.getElementById("startdate"),i=document.getElementById("enddate");if(s.value==""){s.style.backgroundColor="red",s.addEventListener("focus",()=>s.style.backgroundColor="revert",{once:!0});return}let l=Array.from(n.value.matchAll("https://(?:www.)?retroachievements.org/game/([0-9]+)")).map(([o,r])=>r),c=Array.from(n.value.matchAll("https://(?:www.)?retroachievements.org/achievement/([0-9]+)")).map(([o,r])=>r);v("output"),t.disabled=!0,a.disabled=!0,s.disabled=!0,i.disabled=!0,output.innerHTML=f`<h1>Games</h1><hr />${l.map(o=>f`<div class="game"><div class="icon"></div><a class="title" href="https://retroachievements.org/game/${o}">${o}</a><span class="timestamp"></span><div class="status">?</div></div>`).join("")}<h1>Achievements</h1><hr />${c.map(o=>f`<div class="achievement"><div class="icon"></div><a class="title" href="https://retroachievements.org/achievement/${o}">${o}</a><span class="timestamp"></span><div class="status">?</div></div>`).join("")} `;let u=async(o,r)=>{let p=o.querySelector(".title").textContent,h=i.valueAsDate;h.setDate(h.getDate()+1);let m=await r(e,t.value,p,s.valueAsDate,h),y=o.querySelector(".status");y.classList.add(...m.status.split(" ")),y.textContent=m.status.includes("success")?m.status.includes("alt")?"A":"\u2713":"X";let A=document.createElement("img");A.src=`https://media.retroachievements.org${m.icon}`,o.querySelector(".icon").appendChild(A),o.querySelector(".title").textContent=m.title,o.querySelector(".timestamp").textContent=m.timestamp},d=500;for(let o of output.querySelectorAll(".game"))await u(o,x),await S(d);for(let o of output.querySelectorAll(".achievement"))await u(o,E),await S(d);t.disabled=!1,a.disabled=!1,s.disabled=!1,i.disabled=!1});document.getElementById("clear").addEventListener("click",()=>{document.getElementById("username").value="",document.getElementById("submission").value="",document.getElementById("output").innerHTML="",document.getElementById("username").disabled=!1,document.getElementById("startdate").disabled=!1,v("submission")});function R(e,t){let a=JSON.parse(localStorage.getItem("options"));a[e]=t,localStorage.setItem("options",JSON.stringify(a))}function M(e){return JSON.parse(localStorage.getItem("options"))[e]}document.getElementById("optionResetAuth").addEventListener("click",()=>{localStorage.removeItem("auth")});document.getElementById("optionExportURL").addEventListener("click",async()=>{let e=document.getElementById("username").value,t=document.getElementById("altUsername").value,a=document.getElementById("startdate").value,n=document.getElementById("enddate").value,s=document.getElementById("submission").value,i=document.getElementById("optionCheckDate").checked,l=await T({username:e,alt:t,startDate:a,endDate:n,submission:s,optionCheckDate:i}),c=new URL(window.location.href);c.searchParams.set("data",l),window.location.href=c.href});document.getElementById("optionCheckDate").addEventListener("change",e=>{let t=document.getElementById("startdate");e.target.checked?(t.disabled=!1,k()):(t.disabled=!0,t.valueAsDate=new Date(0))});document.getElementById("optionDateFormat").addEventListener("change",e=>{R("dateFormat",e.target.selectedIndex)});if(!localStorage.getItem("options"))localStorage.setItem("options",JSON.stringify({dateFormat:0}));else{let e=JSON.parse(localStorage.getItem("options"));document.getElementById("optionDateFormat").selectedIndex=e.dateFormat}function U(e){let t=e.getUTCFullYear(),a=String(e.getUTCMonth()+1).padStart(2,"0"),n=String(e.getUTCDay()+1).padStart(2,"0");switch(M("dateFormat")){case 0:return`${t}-${a}-${n}`;case 1:return`${a}/${n}/${t}`;case 2:return`${n}/${a}/${t}`;case 3:return`${a}-${n}-${t}`;case 4:return`${n}-${a}-${t}`}}for(let e of document.querySelectorAll("#tabs > div")){let t=e.dataset.target;e.addEventListener("mousedown",()=>{v(t)})}function v(e){document.getElementById(e).style.display="block";for(let t of document.querySelectorAll(`#content > :not(#${e})`))t.style.display="none";for(let t of document.querySelectorAll("#tabs > div"))t.classList.remove("selected"),t.dataset.target==e&&t.classList.add("selected")}async function x(e,t,a,n,s){let i=`https://retroachievements.org/API/API_GetGameInfoAndUserProgress.php?${e}&u=${t}&g=${a}&a=1`,l=await fetch(i).then(r=>r.json()),c="failure";switch(l.HighestAwardKind){case"mastered":c="success mastered";break;case"beaten-hardcore":c="success";break;default:break}let u=new Date(l.HighestAwardDate);(u<n||u>s)&&(c="failure");let d=l.HighestAwardDate?U(u):"N/A",o=document.getElementById("altUsername").value;if(t!=o&&o.length&&c=="failure"){let r=await x(e,o,a,n);if(r.status.includes("success"))return r.status+=" alt",r}return{status:c,title:l.Title,icon:l.ImageIcon,timestamp:d}}async function E(e,t,a,n,s){let i=await fetch(`https://retroachievements.org/API/API_GetAchievementUnlocks.php?${e}&a=${a}&c=1`).then(r=>r.json()),c=(await fetch(`https://retroachievements.org/API/API_GetGameInfoAndUserProgress.php?${e}&u=${t}&g=${i.Game.ID}&a=0`).then(r=>r.json())).Achievements[i.Achievement.ID],u="DateEarnedHardcore"in c,d=u?new Date(c.DateEarnedHardcore):new Date(0),o={status:u&&d>=n&&d<=s?"success":"failure",timestamp:u?U(d):"N/A",title:i.Achievement.Title,icon:`/Badge/${c.BadgeName}.png`};if(o.status=="failure"){let r=document.getElementById("altUsername").value;if(r.length&&r!=t){let p=await E(e,r,a,n,s);if(p.status=="success")return p.status+=" alt",p}}return o}
//# sourceMappingURL=app.js.map
